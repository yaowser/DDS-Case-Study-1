---
title: "MSDS 6306 401 Case Study 1"
author: "Yao Yao"
date: "March 4, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Introduction: 


Import the required libraries needed for the gathering and analysis procedures
```{r}
#require library(downloader), needed for gathering
#require library(ggplot2), needed for plotting
#require library(reshape2), needed for creating a quantile table
```

==Gather GDP and Educational data==

Directory set up and confirmation of files and location
```{r}
#setwd(".\\Data") # set as data directory
getwd()
list.files()
```

Download files via internet, read files into csv into respective destination files
```{r}
library(downloader)
download('https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv', destfile='GDPWeb.csv')
download('https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv', destfile='EducationalWeb.csv')
list.files() #make sure the files are there
```

==clean GDP Data==

Import csv into raw GDP file and examine attributes
```{r}
GDPRaw <- read.csv('GDPWeb.csv',stringsAsFactors = FALSE, header = TRUE)
str(GDPRaw)
```

Eliminate header rows, rows without GDP, and unused columns
Reset column count and examine data
```{r}
GDPData <- GDPRaw[5:194,1:5]
rownames(GDPData) <- seq(length=nrow(GDPData))
head(GDPData)
tail(GDPData)
```
Retitle columns and remove unused columns
```{r}
colnames(GDPData) <- c("CountryCode","Ranking","x","Economy","US Dollars (millions)")
head(GDPData)
GDPData <- GDPData[,c("CountryCode","Ranking","Economy","US Dollars (millions)")]
head(GDPData)
```

Set the ranking as integer and GDP as numeric for later analysis, recheck attributes
```{r}
GDPData$Ranking <- as.integer(GDPData$Ranking)
GDPData$`US Dollars (millions)` <- as.numeric(gsub(",", "", GDPData$`US Dollars (millions)`))
str(GDPData)
dim(GDPData)
```

==Clean Educational Data==

Import raw education data from csv and examine attributes
```{r}
EducationRaw <- read.csv('EducationalWeb.csv',stringsAsFactors = FALSE, header = TRUE)
str(EducationRaw)
dim(EducationRaw)
```

==Merge Education and GDP data==

Merge all columns from raw GDP data and Education based by country code
Save into raw merge file and examine attributes
```{r}
MergeData1 <- merge(x = GDPData, y = EducationRaw, by ='CountryCode', all=TRUE)
head(MergeData1)
tail(MergeData1)
dim(MergeData1)
```

Remove merged columns based on lack of value in GDP, country, GDP ranking, or income group
Examine attributes and reset column count based on country code
```{r}
MergeData2<-MergeData1[rowSums(is.na(MergeData1[,2:5]))==FALSE,]
head(MergeData2)
tail(MergeData2)
dim(MergeData2)
rownames(MergeData2) <- seq(length=nrow(MergeData2))
```

Export data frames into csv file in the data directory to keep track of edits and merges
```{r}
write.csv(MergeData1, "MergeData1.csv")
write.csv(MergeData2, "MergeData2.csv")
write.csv(GDPRaw, "GDPRaw.csv")
write.csv(GDPData, "GDPData.csv")
write.csv(EducationRaw, "EducationRaw.csv")
write.csv(GDPData, "GDPData.csv")
```

==Analysis to answer questions==

Extract the number of rows from origianl merged raw data, 
Track the number of cumulative matched rows, number of N/A values in
Rankings, Economies, GDP, Income groups, and cumulative unmatched rows
```{r}
print(paste0("Total Number of Rows in Merged Data: ", nrow(MergeData1)))
Matches<-sum(is.na(MergeData1$`US Dollars (millions)`) == FALSE & is.na(MergeData1$Income.Group) == FALSE)
print(paste0("Number of Matched Rows: ", Matches))
NARanking<-sum(is.na(MergeData1$Ranking) == TRUE)
print(paste0("Number of N/A Rankings: ", NARanking))
NAEconomy<-sum(is.na(MergeData1$Economy) == TRUE)
print(paste0("Number of N/A Economies: ", NAEconomy))
NAGDP<-sum(is.na(MergeData1$`US Dollars (millions)`) == TRUE)
print(paste0("Number of N/A GDPs: ", NAGDP))
NAIncomeGroup<-sum(is.na(MergeData1$Income.Group) == TRUE)
print(paste0("Number of N/A Income Groups: ", NAIncomeGroup))
NATotal<-sum(is.na(MergeData1$Ranking) == TRUE| is.na(MergeData1$Economy) == TRUE | MergeData1$`US Dollars (millions)` == TRUE | is.na(MergeData1$Income.Group) == TRUE)
print(paste0("Total Number of Unmatched Rows: ", NATotal))
print(paste0("Number of Rows in Merged Data without N/A values: ", nrow(MergeData2)))

```
Question 0) Include code to count the number of missing values for each variable
used in the analysis:

For each of the variables utilized in the analysis,
there are 45 N/A values for rankings, economies, and GDP.
There is one country with a N/A value for income groups and is also eliminated,
which results in a total of 46 unmatched rows

Question 1) Merge the data based on the country shortcode. How many of the IDs match?

After merging the data by country shortcode and eliminating pertinent rows with N/A values,
189 countries has GDP, educational, and ranking values matching with income group.

Rank the merged data by ascending GDP ranking, examine attributes and export dataset
```{r}
NegGDP <- MergeData2[order(MergeData2$`US Dollars (millions)`),] 
head(NegGDP)
str(NegGDP)
write.csv(NegGDP, "NegGDP.csv")
```

Code to find 13th country with the ascending GDP. 
More code to show that there is a tie between St. Kitts and Grenada at 12th place,
which results the alphabetical order to dictate St. Kitts at 13th place in ranking.
```{r}
country13NegGDP<-NegGDP[13,3]
print(paste0("The 13th country in ascending order by GDP is: ", country13NegGDP))
NegGDP[12:13,c(2, 3, 4, 6)]
```
Question 2) Sort the data frame in ascending order by GDP (so United States is last).
What is the 13th country in the resulting data frame?

From ascending GDP, country #13 is St. Kitts and Nevis in the resulting data frame NegGDP.
Technically, St. Kitts and Grenada are tied at 12th in ascending GDP and further ascending
alphabetical sorting makes St. Kitts appear at 13th and Grenada at 12th place.

Assign a subset of High Income OECD countries from income group and
find the mean of their GDP rank
```{r}
HIOECD <- MergeData2[ which(MergeData2$Income.Group=='High income: OECD'), ]
head(HIOECD)
write.csv(HIOECD, "HIOECD.csv")
HAvgGDPRank<- mean(HIOECD$Ranking)
print(paste0("The average GDP ranking of high income, OECD countries is: ", round(HAvgGDPRank, digits = 2)))
```

Assign a subset of High Income nonOECD countries from income group and
find the mean of their GDP rank
```{r}
HINonOECD <- MergeData2[ which(MergeData2$Income.Group=='High income: nonOECD'), ]
head(HINonOECD)
write.csv(HINonOECD, "HINonOECD.csv")
NAvgGDPRank<- mean(HINonOECD$Ranking)
print(paste0("The average GDP ranking of high income, nonOECD countries is: ", round(NAvgGDPRank, digits = 2)))
```
Question 3) What are the average GDP rankings for the "High income: OECD" and 
"High income: nonOECD" groups?

By income group, the average GDP rankings for High income: OECD countries is 32.97
and for High income: nonOECD countries is 91.91.
High income OECD countries have higher GDP than that of High income nonOECD countries.
Higher GDP ranking suggests that high income countries that are open to free world trade
and development are more prosperous.

Using ggplot2, individual countries with matching rows in GDP are logarithmically plotted
by separately colored income group box plots to show quantile distribution.
```{r}
library(ggplot2)
NegGDP$Income.Group <- factor(NegGDP$Income.Group, levels=c("Low income", "Lower middle income", "Upper middle income", "High income: nonOECD", "High income: OECD"))
color.codes<-as.character(c("#3399FF", "#FF0000","#0000FF", "#00FF00", "#D95F02"))
ggplot(data = NegGDP, aes(y = `US Dollars (millions)`, x = Income.Group, colour = Income.Group))+ 
   geom_boxplot() + scale_y_log10() +
  scale_colour_manual(breaks = NegGDP$Income.Group,values = unique(as.character(color.codes)))
```
Question 4) Show the distribution of GDP value for all the countries and color plots
by income group. Use ggplot2 to create your plot.

Graphically by boxplot log distribution, it was expected that the median GDP of countries
grouped by income group rose from low income to lower middle income to 
upper middle income. For high income countries, there is a discrepancy between
OECD and nonOECD countries. If the country is high income but does not allow free global
trade and development, they have an median GDP lower than that of upper middle income
countries and about equivalent to that of lower middle income countries. Otherwise,
if the high income country is an OECD member, they countinue the trend of GDP prosperity.
In addition, the giant range of counties that fall into the lower middle income category suggests that the distinction of countries by income groups is not soley based on
GDP qualities alone.

GDP summary statistics of countries based on income groups
```{r}
tapply(NegGDP$`US Dollars (millions)`, NegGDP$Income.Group, summary)
```
Question 5) Provide summary statistics of GDP by income groups.

From the boxplot log distribution of countries' GDP separated by income groups,
the quantile distributions were plotted by range, interquantile range, and medians. 
The summary statistics show that the mean GDP per income group is very different than
that of the median, with the mean being 0.8x, 9.5x, 4.3x, 2.6x, and 2x greater than 
that of the median for their respective income groups by ascending classification.

The range overlap in country GDP further suggests that countries separated by income group
was not soley based on GDP. The order of mean GDP by income group is low income, 
high income: nonOECD, upper middle income, lower middle income, and high income: OECD,
which means that there are more factors that dictate how a country is classifed into
income groups than GDP alone.

Breaks the GDP rankings into 5 separate quantile groups, with increment of 20%, and writes
the quantiles into csv. Negdata is used because factors and levels are defined previously
```{r}
Quantiles<-cut(NegGDP$Ranking, breaks=quantile(NegGDP$Ranking,seq(0, 1, 0.2)))
head(Quantiles)
write.csv(Quantiles, "Quantiles.csv")
```
Using reshape2, a table shows the number of contries per income group that falls inside 
their respective 20% quantile groups based on individual GDP ranking
```{r}
library(reshape2)
table(NegGDP$Income.Group, Quantiles)
```
Question 6a) Cut the GDP ranking into 5 separate quantile groups.
Make a table versus Income.Group.

It was expected that low income has more countries that fall inside the higher quantile
GDP rankings while that of the higher income: OECD has more that fall inside the lower
GDP quantile rankings. Lower middle income has a concentration of counties that fall
inside ther higher GDP rankings with some of its countries in the lower quantile GDP
rankings. Upper middle income countries has an even distribution of countries in each
quantile category while that of high income: nonOECD countries have countries falling
in the middle GDP quantile rankings.

Create a subset featuring GDP ranking, country, and Income group and examine attributes
```{r}
IncomeSub <- MergeData2[c(2,3,6)]
IncomeSub<-IncomeSub[order(IncomeSub$Ranking),]
rownames(IncomeSub) <- seq(length=nrow(IncomeSub))
head(IncomeSub)
write.csv(IncomeSub, "IncomeSub.csv")
```

Find the subset and number of countries that are lower middle in income group and 
top 38 in GDP ranking. Export new dataset as LowerMiddleTop38.
```{r}
LowerMiddleTop38 <- IncomeSub[which(IncomeSub$Ranking <= 38 & IncomeSub$Income.Group == "Lower middle income"),]
rownames(LowerMiddleTop38) <- seq(length=nrow(LowerMiddleTop38))
LowerMiddleTop38
write.csv(LowerMiddleTop38, "LowerMiddleTop38.csv")
print(paste0("The number of lower income countries that are in the top 38 for GDP ranking is: ", nrow(LowerMiddleTop38)))

```
Question 6b) How many countries are Lower middle income but among the 38 nations with highest GDP?

The table shows there are 5 lower income countries that are in the top 38 for GDP ranking.

Conclusion: 


